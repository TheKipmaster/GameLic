<p id="notice"><%= notice %></p>

<div class="main" id="narratives-index">

  <div class="narratives-header">
    <h1>CAMPANHAS</h1>

    <% if can? :manage, Narrative %>
      <div class="links">
        <a href="<%= users_path %>">
          <img src="<%= image_url('Pergaminho.svg') %>" alt="">
          <span>Lista de Inscritos</span>
        </a>

        <a href="<%= new_narrative_path %>">
          <img src="<%= image_url('Espada.svg') %>" alt="">
          <span>Criar Nova Campanha</span>
        </a>
      </div>
    <% end %>
  </div>

    <div class="narratives-container">
      <% @narratives.each do |narrative| %>
        <a href="<%= narrative_path(narrative) %>" class="narrative-card">

          <% if narrative.avatar.attached? %>
            <%= image_tag(narrative.avatar)%>
          <% end %>
          <h2>
            <%= narrative.title %>
          </h2>
          <p>
            <%= truncate(narrative.description, length: 130) %>
          </p>

          <div class="narrative-card-footer">
            <% if narrative.open %>
              <span>Há vagas</span>
            <% else %>
              <img src="<%= image_url('Lock.svg') %>" alt="">
            <% end %>
            <span>
              <b>
                <%= narrative.students.length %> / <%= narrative.size %> <br>
              </b>
              Inscritos
            </span>
          </div>
        </a>
      <% end %>
    </div>

  <% if can? :manage, Narrative %>
    <% if Narrative.first.nil? %>
      <%# If no narratives present in database, then show no link %>
    <% elsif Narrative.open? %>
      <%= link_to 'Fechar Inscrições', open_registration_narratives_path, method: :patch %> <br>
    <% else %>
      <%= link_to 'Abrir Inscrições', open_registration_narratives_path, method: :patch %> <br>
    <% end %>
  <% end %>

  <%= link_to 'Início', root_path %>

</div>
